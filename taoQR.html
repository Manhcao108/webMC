<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T·∫°o QR Code</title>
<!--  th√™m favicon    -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîó</text></svg>" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      display: flex;
      justify-content: center;
      padding: 30px;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 420px;
      text-align: center;
    }
    .input-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 5px;
    }
    .input-row label {
      font-size: 16px;
      cursor: pointer;
    }
    input[type="text"], textarea {
      width: 80%;
      padding: 8px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      resize: none;
    }
    input[type="color"] {
      vertical-align: middle;
      margin-left: 8px;
      margin-right: 8px;
    }
    button {
      padding: 8px 15px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #3498db;
      color: white;
      transition: 0.3s;
      font-size: 16px;
    }
    button:hover {
      background: #2980b9;
    }
    .delete-btn {
      background: #e74c3c;
    }
    .delete-btn:hover {
      background: #c0392b;
    }
    .clear-btn {
      background: #f39c12;
    }
    .clear-btn:hover {
      background: #d68910;
    }
    .edit-btn {
      background: #7ed957;
      color: #fff;
    }
    .edit-btn:hover {
      background: #5bbd36;
    }
    #qrcode {
      margin: 15px auto;
    }
    #savedQRCodes {
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      text-align: left;
    }
    .saved-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid #ddd;
      padding: 10px 5px;
      background: #fafafa;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    .saved-left {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }
    .saved-item img {
      width: 60px;
      height: 60px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .url-text {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: 14px;
      color: #333;
      gap: 3px;
      word-break: break-word;
    }
    .url-text span {
      font-weight: 500;
      color: #2c3e50;
    }
    .item-date {
      font-size: 12px;
      color: #8c8c8c;
    }
    .security-note {
      font-size: 13px;
      color: #e67e22;
      background: #fff8e1;
      border: 1px solid #f3d19c;
      border-radius: 6px;
      padding: 8px 10px;
      margin-bottom: 12px;
      margin-top: 8px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .security-note b {
      color: #d35400;
    }
    @media (max-width: 600px) {
      .container {
        padding: 10px;
        max-width: 98vw;
      }
      input[type="text"], textarea {
        width: 98%;
      }
    }
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: #323232;
      color: #fff;
      padding: 10px 25px;
      border-radius: 6px;
      font-size: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s;
      z-index:9999;
    }
    .toast.active {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>üîó T·∫°o M√£ QR t·ª´ URL ho·∫∑c VƒÉn b·∫£n</h2>
  <div class="security-note">
    <span>üîí</span>
    <div>
      <b>L∆∞u √Ω s·ª≠ d·ª•ng:</b><br>
      Load l·∫°i web sau khi ƒë√£ t·∫°o QR ƒë·ªÉ ƒë·ªïi m√†u v√† t·∫°o QR m·ªõi.<br>
      L√ù DO: ƒêang n√¢ng c·∫•p v√† c·∫£i t·∫°o.<br>
      T·∫°o QR b·∫±ng vƒÉn b·∫£n t·∫°m th·ªùi ch∆∞a d√πng ƒë∆∞·ª£c.<br>
      ƒê·ªô d√†i t·ªëi ƒëa cho n·ªôi dung: <b>512 k√Ω t·ª±</b>.
    </div>
  </div>
  <div class="input-row">
    <label>
      <input type="radio" name="dataType" value="url" checked onchange="switchInputType()" />
      URL
    </label>
    <label>
      <input type="radio" name="dataType" value="text" onchange="switchInputType()" />
      VƒÉn b·∫£n
    </label>
  </div>
  <input type="text" id="urlInput" placeholder="Nh·∫≠p URL..." autocomplete="off" maxlength="512" style="display:block" />
  <textarea id="textInput" placeholder="Nh·∫≠p n·ªôi dung vƒÉn b·∫£n..." maxlength="512" rows="3" style="display:none"></textarea>
  <input type="color" id="colorPicker" value="#000000" />
  <button onclick="generateQRCode()">T·∫°o QR</button>

  <div id="qrcode"></div>
  <button id="saveBtn" style="display:none;" onclick="saveQRCode()">üíæ L∆∞u QR n√†y</button>
  <button id="downloadBtn" style="display:none;" onclick="downloadQRCode()">‚¨áÔ∏è T·∫£i xu·ªëng</button>

  <h3>üìÇ L∆∞u tr·ªØ QR</h3>
  <button class="clear-btn" onclick="clearAllQRCodes()">üßπ X√≥a t·∫•t c·∫£</button>
  <div id="savedQRCodes"></div>
</div>
<div id="toast" class="toast"></div>

<!-- Th∆∞ vi·ªán QRCodeJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
  let lastDataUrl = "";
  let editingIndex = null;
  const MAX_LENGTH = 512;
  let qrCodeInstance = null;

  function showToast(msg) {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.classList.add('active');
    setTimeout(() => { toast.classList.remove('active'); }, 1800);
  }

  function isValidURL(url) {
    try {
      new URL(url);
      return true;
    } catch {
      return false;
    }
  }

  function switchInputType() {
    const type = document.querySelector('input[name="dataType"]:checked').value;
    document.getElementById("urlInput").style.display = type === "url" ? "block" : "none";
    document.getElementById("textInput").style.display = type === "text" ? "block" : "none";
  }

  function getInputValue() {
    const type = document.querySelector('input[name="dataType"]:checked').value;
    if (type === "url") {
      return document.getElementById("urlInput").value.trim();
    } else {
      return document.getElementById("textInput").value.replace(/\r\n/g,"\n").trim();
    }
  }

  function generateQRCode() {
    const type = document.querySelector('input[name="dataType"]:checked').value;
    let value = getInputValue();
    const color = document.getElementById("colorPicker").value;

    if (!value) {
      showToast(type === "url" ? "‚ùó Vui l√≤ng nh·∫≠p URL" : "‚ùó Vui l√≤ng nh·∫≠p vƒÉn b·∫£n");
      return;
    }
    if (value.length > MAX_LENGTH) {
      showToast("‚ùó N·ªôi dung v∆∞·ª£t qu√° " + MAX_LENGTH + " k√Ω t·ª±");
      return;
    }
    if (type === "url" && !isValidURL(value)) {
      showToast("‚ùó URL kh√¥ng h·ª£p l·ªá");
      return;
    }

    const qrcodeDiv = document.getElementById("qrcode");

    if (qrCodeInstance) {
      qrCodeInstance.clear();
    } else {
      qrCodeInstance = new QRCode(qrcodeDiv, {
        width: 200,
        height: 200,
        colorDark: color,
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });
    }

    // T·∫°o QR code tr·ª±c ti·∫øp t·ª´ gi√° tr·ªã nh·∫≠p (URL ho·∫∑c vƒÉn b·∫£n)
    qrCodeInstance.makeCode(value);

    setTimeout(() => {
      const canvas = qrcodeDiv.querySelector("canvas");
      if (canvas) {
        lastDataUrl = canvas.toDataURL("image/png");
        document.getElementById("saveBtn").style.display = "inline-block";
        document.getElementById("downloadBtn").style.display = "inline-block";
      } else {
        showToast("‚ùó Kh√¥ng th·ªÉ t·∫°o m√£ QR");
      }
    }, 500);
  }

  function saveQRCode() {
    if (!lastDataUrl) return;

    const type = document.querySelector('input[name="dataType"]:checked').value;
    const value = getInputValue();
    const color = document.getElementById("colorPicker").value;
    const date = new Date().toLocaleString();
    let savedList = JSON.parse(localStorage.getItem("qrList")) || [];

    if (value.length > MAX_LENGTH) {
      showToast("‚ùó N·ªôi dung v∆∞·ª£t qu√° " + MAX_LENGTH + " k√Ω t·ª±");
      return;
    }

    if (editingIndex !== null) {
      savedList[editingIndex] = { value, type, color, img: lastDataUrl, date };
      showToast("‚úÖ ƒê√£ c·∫≠p nh·∫≠t QR!");
      editingIndex = null;
    } else {
      const idx = savedList.findIndex(i => i.value === value && i.type === type && i.color === color);
      if (idx !== -1) {
        showToast("‚ùó QR n√†y ƒë√£ ƒë∆∞·ª£c l∆∞u tr∆∞·ªõc ƒë√≥");
        return;
      }
      savedList.push({ value, type, color, img: lastDataUrl, date });
      showToast("‚úÖ ƒê√£ l∆∞u QR!");
    }

    localStorage.setItem("qrList", JSON.stringify(savedList));
    renderSavedQRCodes();
    document.getElementById("saveBtn").style.display = "none";
    document.getElementById("downloadBtn").style.display = "inline-block";
  }

  function downloadQRCode() {
    if (!lastDataUrl) return;
    const link = document.createElement("a");
    link.href = lastDataUrl;
    link.download = "qrcode.png";
    link.click();
  }

  function deleteQRCode(index) {
    let savedList = JSON.parse(localStorage.getItem("qrList")) || [];
    savedList.splice(index, 1);
    localStorage.setItem("qrList", JSON.stringify(savedList));
    renderSavedQRCodes();
    showToast("üóëÔ∏è ƒê√£ x√≥a QR!");
  }

  function editQRCode(index) {
    let savedList = JSON.parse(localStorage.getItem("qrList")) || [];
    const item = savedList[index];
    document.querySelector('input[name="dataType"][value="' + item.type + '"]').checked = true;
    switchInputType();
    if (item.type === "url") {
      document.getElementById("urlInput").value = item.value;
    } else {
      document.getElementById("textInput").value = item.value;
    }
    document.getElementById("colorPicker").value = item.color;
    generateQRCode();
    editingIndex = index;
    document.getElementById("saveBtn").style.display = "inline-block";
    showToast("‚úèÔ∏è ƒêang s·ª≠a QR, b·∫•m L∆∞u QR n√†y ƒë·ªÉ c·∫≠p nh·∫≠t");
    window.scrollTo({top:0,behavior:"smooth"});
  }

  function clearAllQRCodes() {
    if (confirm("‚ùì B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô QR ƒë√£ l∆∞u?")) {
      localStorage.removeItem("qrList");
      renderSavedQRCodes();
      showToast("üßπ ƒê√£ x√≥a t·∫•t c·∫£ QR!");
    }
  }

  function renderSavedQRCodes() {
    const savedContainer = document.getElementById("savedQRCodes");
    savedContainer.innerHTML = "";
    let savedList = JSON.parse(localStorage.getItem("qrList")) || [];

    if (savedList.length === 0) {
      savedContainer.innerHTML = "<p style='text-align:center; color:#888;'>Kh√¥ng c√≥ QR n√†o ƒë∆∞·ª£c l∆∞u</p>";
      return;
    }

    savedList.forEach((item, index) => {
      const div = document.createElement("div");
      div.classList.add("saved-item");

      const left = document.createElement("div");
      left.classList.add("saved-left");

      const img = document.createElement("img");
      img.src = item.img;

      const textWrapper = document.createElement("div");
      textWrapper.classList.add("url-text");
      let label = item.type === "url" ? "üîó URL" : "üìù VƒÉn b·∫£n";
      textWrapper.innerHTML =
        label + ": <span>" + item.value.replace(/\n/g, "<br>") + "</span>" +
        "<span style='color:"+item.color+";'>M√†u QR: " + item.color + "</span>" +
        "<div class='item-date'>üìÖ " + (item.date || '') + "</div>";

      left.appendChild(img);
      left.appendChild(textWrapper);

      const editBtn = document.createElement("button");
      editBtn.textContent = "‚úèÔ∏è";
      editBtn.title = "S·ª≠a QR n√†y";
      editBtn.classList.add("edit-btn");
      editBtn.onclick = () => editQRCode(index);

      const delBtn = document.createElement("button");
      delBtn.textContent = "üóëÔ∏è";
      delBtn.title = "X√≥a QR n√†y";
      delBtn.classList.add("delete-btn");
      delBtn.onclick = () => deleteQRCode(index);

      div.appendChild(left);
      div.appendChild(editBtn);
      div.appendChild(delBtn);
      savedContainer.appendChild(div);
    });
  }

  window.onload = function() {
    renderSavedQRCodes();
    switchInputType();
  };
</script>
</body>

</html>
